# ESchaT (이스챗)

벡터 데이터베이스를 활용한 지식기반 챗봇 시스템

바이브코딩 과제 프로젝트로, 제공된 Q&A 데이터셋을 기반으로 할루시네이션 없이 정확한 응답을 제공하는 챗봇 시스템입니다.

---

## 📋 목차

- [사용 기술 스택](#사용-기술-스택)
- [벡터 DB 및 임베딩 방식](#벡터-db-및-임베딩-방식)
- [정확도 향상 전략](#정확도-향상-전략)
- [시작하기](#시작하기)
- [API 엔드포인트](#api-엔드포인트)

---

## 🛠 사용 기술 스택

### Frontend Framework
- **React** - 컴포넌트 기반 아키텍처로 챗봇 UI의 동적 상태 관리와 실시간 메시지 렌더링에 최적화된 라이브러리

### Backend Framework
- **Python** - AI/ML 생태계의 풍부한 라이브러리와 한국어 NLP 모델 지원으로 벡터 임베딩 및 자연어 처리 구현에 적합
- **FastAPI** - 비동기 처리로 벡터 검색과 임베딩 생성 시 발생하는 I/O 대기 시간을 최소화하여 챗봇 응답 속도 향상

### Vector Database
- **Qdrant** - 밀리초 단위의 고속 유사도 검색으로 실시간 챗봇 응답에 필수적인 성능 제공, 클라우드 및 온프레미스 배포 유연성으로 확장성 확보

### AI/ML 라이브러리
- **LangChain Community** - Qdrant와의 벡터스토어 통합을 간소화하고 문서 관리 기능을 제공하여 질문-답변 데이터셋의 효율적인 저장 및 검색 구현
- **Sentence Transformers** - 한국어 텍스트의 의미적 유사도를 정확히 측정하기 위해 한국어 특화 모델을 활용하여 할루시네이션 방지

### 데이터 처리
- **Pandas** - 제공된 Q&A 데이터셋의 전처리 및 변환 작업을 효율적으로 수행하기 위한 데이터프레임 처리 라이브러리
- **OpenPyXL** - Excel 형식의 Q&A 데이터셋을 읽어 벡터 데이터베이스에 저장하기 위한 파일 처리 라이브러리

---

## 🗄 벡터 DB 및 임베딩 방식

### 벡터 데이터베이스: Qdrant

**Qdrant**는 고성능 벡터 검색을 위한 전문 데이터베이스입니다.

#### 선택 이유
- **고성능**: 밀리초 단위의 빠른 유사도 검색
- **확장성**: 수백만 개의 벡터 처리 가능
- **유연성**: 클라우드(Qdrant Cloud) 및 자체 호스팅 지원
- **한국어 지원**: 다양한 임베딩 모델과 호환

#### 데이터 구조
```
Collection: qa_collection
├── Vector Dimension: 384 (임베딩 모델 출력 차원)
├── Distance Metric: Cosine Similarity
└── Metadata:
    ├── question: 원본 질문 텍스트
    └── answer: 해당 질문의 답변
```

### 임베딩 모델

**모델**: `kimseongsan/ko-sbert-384-reduced`

#### 특징
- **한국어 특화**: 한국어 텍스트에 최적화된 Sentence-BERT 모델
- **차원**: 384차원 벡터 (경량화된 버전)
- **성능**: 한국어 의미 유사도 검색에 우수한 성능
- **속도**: 경량 모델로 빠른 임베딩 생성

#### 임베딩 프로세스
```
사용자 질문
    ↓
Sentence Transformer 모델
    ↓
384차원 벡터
    ↓
Qdrant 유사도 검색 (Cosine Distance)
    ↓
Top-K 유사 질문 반환
```

#### 유사도 측정 방식
- **거리 메트릭**: Cosine Distance (코사인 거리)
- **점수 범위**: 0.0 ~ 1.0 (1.0에 가까울수록 유사)
- **검색 방식**: `similarity_search_with_score`로 점수와 함께 반환

---

## 🎯 정확도 향상 전략

### 1. Top-K 검색 전략

단일 결과가 아닌 **Top-K 후보**를 검색하여 정확도를 향상시킵니다.

```python
# 기본값: TOP_K = 3
results = vs.similarity_search_with_score(question, k=TOP_K)
```

**장점**:
- 유사도가 비슷한 여러 후보를 비교 가능
- 최상위 결과가 부정확할 경우 대안 제시 가능

### 2. 신뢰도 기반 분류 시스템

유사도 점수에 따라 **3단계 신뢰도 레벨**을 적용합니다.

| 신뢰도 레벨 | 점수 범위 | 동작 |
|------------|---------|------|
| **High** | ≥ 0.85 | 즉시 답변 제공 |
| **Medium** | 0.70 ~ 0.85 | 즉시 답변 제공 |
| **Low** | 0.50 ~ 0.70 | 사용자 확인 후 답변 |
| **Rejected** | < 0.50 | 답변 거부 |

**구현 로직**:
```python
if score >= 0.85:
    confidence = "high"
elif score >= 0.7:
    confidence = "medium"
elif score >= 0.5:
    confidence = "low"
    needs_confirmation = True
else:
    # 답변 거부
```

### 3. 사용자 확인 메커니즘

낮은 신뢰도(0.5 ~ 0.7)일 때 **사용자 확인**을 요청합니다.

**동작 방식**:
- Top-1 결과의 질문을 사용자에게 제시
- "이 질문에 대한 답변을 원하시나요?" 확인
- 사용자가 긍정하면 답변 제공

**대안 질문 제시**:
- Top-2, Top-3 결과를 대안 질문으로 제공
- 사용자가 원하는 질문을 선택할 수 있도록 지원

### 4. 임계값 기반 필터링

**최소 임계값: 0.5**

- 0.5 미만의 유사도 점수는 **자동 거부**
- 할루시네이션 방지: 관련 없는 답변 제공 차단
- 명확한 오류 메시지로 사용자 안내

### 5. 메타데이터 기반 답변 매칭

**구조화된 데이터 저장**:
```python
Document(
    page_content=question,      # 검색 대상
    metadata={"answer": answer}  # 답변 저장
)
```

**장점**:
- 질문과 답변을 분리하여 저장
- 질문으로 검색, 답변으로 응답
- 정확한 매칭 보장

### 6. 에러 처리 및 사용자 경험

- **명확한 오류 메시지**: 사용자 친화적인 한국어 메시지
- **빈 결과 처리**: 검색 결과가 없을 때 적절한 안내
- **타임아웃 처리**: Qdrant 연결 실패 시 재시도 로직


---

## 📝 라이선스

이 프로젝트는 바이브코딩 과제용으로 개발되었습니다.
